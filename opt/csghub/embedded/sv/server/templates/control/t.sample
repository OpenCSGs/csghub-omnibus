#!/bin/sh
exec 1>&2

FULL_NAME='/opt/csghub/embedded/bin/csghub-server.*start server'
if pgrep -f "$FULL_NAME" >/dev/null; then
    echo "Stopping server processes..."

    # First try graceful termination
    pkill -TERM -f "$FULL_NAME"

    # Wait for processes to exit
    sleep 2

    # Check if any processes remain
    if pgrep -f "$FULL_NAME" >/dev/null; then
        echo "Force killing remaining server processes..."
        pkill -KILL -f "$FULL_NAME" || true
    fi

    # Final verification
    if pgrep -f "$FULL_NAME" >/dev/null; then
        echo "Warning: Some server processes still running!"
        exit 1
    else
        echo "server stopped successfully"
    fi
else
    echo "No server processes running"
fi
