#!/bin/bash

# Redirect stderr -> stdout
exec 2>&1

# fail on errors
set -e

{{- $dataDir := (datasource "config").nats.data | default "/var/opt/csghub/nats" }}
chown -R nats:nats {{ $dataDir }} || true

cd {{ $dataDir }}
exec chpst -e /opt/csghub/etc/nats/env -P \
  -u nats:nats \
  /opt/csghub/embedded/bin/nats-server -c {{ $dataDir }}/nats.conf
